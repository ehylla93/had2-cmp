// AL2_agent - Agent Elisabeth Salter
// -------------------------------------------------------------------------------------------------------------
// Variables definition

Block
{
Frame ge05;		FRM_FindFrame(ge05, "AL2_05");

Frame al2_09;		FRM_FindFrame(al2_09,"al2_09");
Frame al2_10;		FRM_FindFrame(al2_10,"al2_10");

Frame morphx;	FRM_FindFrame(morphx, "A210kecac");
Frame obj;		FRM_FindFrame(obj, "AL2_objective");
Frame al2_11;	FRM_FindFrame(al2_11, "AL2_11");
Frame al2_07;	FRM_FindFrame(al2_07, "AL2_07");
Frame dvere;	FRM_FindFrame(dvere, "B22_pchd_01");

Frame unlock_detect2;	FRM_FindFrame(unlock_detect2,"unlock_detect2");

Frame me;	FRM_GetMyFrame(me);
Frame get_player;

HUMAN_SetOptimized(1);

SetAlarmType(1023, false);
}

HUMAN_SETEVENTS(false);
HUMAN_Suspend(true);
GoTo end;

// -------------------------------------------------------------------------------------------------------------
// Whenever keywords and signals

OnDeath()
{
DisableWhenevers(1);
DisableSignals(1);
HUMAN_SetAnim("",0,0,0);
FRM_MorphSpeech(me, 0,0,0);
SendSignal(obj, 8);
goto end;
}

Whenever activate(_SignalReceived(1))	// received from AL2_agent_A1
{
	HUMAN_Suspend(false);
	GoTo end;
}

Whenever dooropened(_SignalReceived(2))	// received from AL2_agent_A2
{
	HUMAN_SetAnim("%%borkasearch",100,500,1);
	GoTo end;
}

Whenever dokumenty(_SignalReceived(3))	// received from AL2_dokumenty
{
	SUBTITLES_SetOn(1);
	FRM_MorphSpeech(me, 15993029,5,20);		//"Quickly towards the gate now!"
	delay(3000);
	SUBTITLES_SetOn(0);
	Block {
	SendSignal(obj, 5);
	DisableWhenevers(1);
	DisableSignals(1);
	EnableSignal(4, true);
	}
	goto FOLLOW;
}

Whenever player(_PlayerInRange(2))
{
SendSignal(ge05,23);
SUBTITLES_SetOn(1);
FRM_GetNearestPlayer(me, get_player); 
FRM_MorphSpeechDelayed(get_player, 15993086, 3, 9);
delay (1200);
SendSignal (al2_07,2);
HUMAN_SetAnim("",300,300,0);
SendSignal (unlock_detect2,2);
goto PATH;
}

OnSignal(4)
{
HUMAN_Stop();
HUMAN_SETMODE_Crouch();
goto end;
}

// -------------------------------------------------------------------------------------------------------------

Label PATH:
Delay(1000);
HUMAN_TurnAtNearestPlayer();
FRM_MorphSpeechDelayed(me, 15993026,5,20);
Delay(200);
FRM_MorphSpeechDelayed(me, 15993027,5,20);
PlayMusic(36);
SendSignal(obj, 4);
	
 label PATH1:
   If (_PlayerInRange(3)) 
      {
		HUMAN_Move("AL2_ag_01");
		HUMAN_Move("al2_agx_01");
		HUMAN_Move("al2_agx_02");
		goto PATH2;
      } else { 
		HUMAN_TurnAtNearestPlayer();
        delay(150);
        goto PATH1;
      }

 label PATH2:
   If (_PlayerInRange(5)) 
      { 
		HUMAN_Move("al2_agx_002");
		HUMAN_Move("al2_agx_03");
		HUMAN_Move("al2_agx_033");
		goto PATH3;
      } else { 
		HUMAN_TurnAtNearestPlayer(); 
        delay(150);
        goto PATH2;
      }

 label PATH3:
   If (_PlayerInRange(5)) 
      { 
		HUMAN_Move("al2_agx_04");
		HUMAN_Move("al2_agx_05");
		SendSignal (al2_07,3);
		goto PATH4;
      } else { 
		HUMAN_TurnAtNearestPlayer(); 
        delay(150);
        goto PATH3;
      }	

 label PATH4:
   If (_PlayerInRange(5)) 
      { 
		HUMAN_Move("AL2_ag_05");
		HUMAN_Move("AL2_ag_05b");
		goto PATH5;
      } else { 
		HUMAN_TurnAtNearestPlayer(); 
        delay(150);
        goto PATH4;
      }	

 label PATH5:
   If (_PlayerInRange(5))
      { 
		HUMAN_Move("AL2_ag_05c");
		HUMAN_Move("AL2_ag_06");
		goto PATH6;
      } else { 
		HUMAN_TurnAtNearestPlayer(); 
        delay(150);
        goto PATH5;
      }

 label PATH6:
   If (_PlayerInRange(5))
      {
		HUMAN_Move("AL2_ag_06x");
		HUMAN_Move("AL2_ag_07");
		goto PATH7;
      } else {
		HUMAN_TurnAtNearestPlayer(); 
        delay(150);
        goto PATH6;
      }
	  
 label PATH7:
   If (_PlayerInRange(5))
      {
		HUMAN_Move("AL2_ag_07_1");
		DOOR_Lock(dvere, 0);
		HUMAN_Move("AL2_ag_08");
		HUMAN_TurnAtNearestPlayer();
		goto PATH8;
      } else {
		HUMAN_TurnAtNearestPlayer(); 
        delay(150);
        goto PATH7;
      }
	  
 label PATH8:
   If (_PlayerInRange(5))
      {
		HUMAN_TurnAtNearestPlayer();
		goto ARCHIVE;
      } else {
		HUMAN_TurnAtNearestPlayer(); 
        delay(150);
        goto PATH8;
      }
	
Label ARCHIVE:
block
{
SendSignal (al2_10,10);
SendSignal (al2_09,10);
SendSignal (morphx,3);
}
HUMAN_TurnAtNearestPlayer();
SUBTITLES_SetOn(1);
FRM_MorphSpeechDelayed(me, 15993088,5,20);
Delay(200);
FRM_MorphSpeechDelayed(me, 15993089,5,20);
SUBTITLES_SetOn(0);
Delay(20000);
HUMAN_TurnAtNearestPlayer();
SUBTITLES_SetOn(1);
FRM_MorphSpeechDelayed(me, 15993090,5,20);	//"Let's go, what are you waiting for?"
SUBTITLES_SetOn(0);
goto end;

Label FOLLOW:
	If(_PlayerInRange(8))
	{
	FRM_GetNearestPlayer(me, get_player);
	HUMAN_SETMODE_Run();
	HUMAN_MoveToFrame(get_player, 1);
		
		If(_PlayerInRange(4))
		{
			HUMAN_SETMODE_Crouch();
			HUMAN_SETMODE_Run();
			HUMAN_TurnAtNearestPlayer();
			goto FOLLOW;
		}
		else
		{
		HUMAN_SETMODE_Stand();
		HUMAN_SETMODE_Run();
		goto FOLLOW;
		}
	}
	goto FOLLOW;

Label end: